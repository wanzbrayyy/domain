<%- include('partials/header', { title: title }) %>

<script type="text/javascript" src="https://app.midtrans.com/snap/snap.js" data-client-key="<%= clientKey %>"></script>

<!-- ... (style dari halaman confirm-registration sebelumnya) ... -->
<style>
    .stepper { display: flex; align-items: center; border: 1px solid #ddd; border-radius: 50px; }
    .stepper button { background: #f9f9f9; border: none; padding: 10px 20px; cursor: pointer; font-size: 1.2rem; }
    .stepper input { width: 60px; text-align: center; border: none; font-size: 1.1rem; font-weight: 600; }
    .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--nexus-primary); }
    input:checked + .slider:before { transform: translateX(26px); }
</style>

<div class="card" style="max-width: 600px; margin: 2rem auto;">
    <h2><i class="fas fa-shopping-cart"></i> Ringkasan Pesanan</h2>
    
    <% if (cart.type === 'domain') { %>
        <p>Anda akan mendaftarkan domain: <strong><%= cart.item.domain %></strong></p>
        <form id="options-form" action="/update-cart-options" method="POST">
            <div style="margin-top: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h4>Periode Registrasi</h4>
                    <div class="stepper">
                        <button type="button" onclick="changePeriod(-1)">-</button>
                        <input type="number" name="period" value="<%= cart.options.period %>" min="1" max="5" readonly>
                        <button type="button" onclick="changePeriod(1)">+</button>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h4>Proteksi WHOIS</h4>
                    <label class="switch">
                        <input type="checkbox" name="buy_whois_protection" <%= cart.options.buy_whois_protection ? 'checked' : '' %> onchange="document.getElementById('options-form').submit()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </form>
        <script>
            function changePeriod(amount) {
                const input = document.querySelector('input[name="period"]');
                let value = parseInt(input.value) + amount;
                if (value >= 1 && value <= 5) {
                    input.value = value;
                    document.getElementById('options-form').submit();
                }
            }
        </script>
    <% } else { %>
        <p>Anda memesan produk: <strong><%= cart.item.name %></strong></p>
    <% } %>
    
    <hr style="margin: 2rem 0;">
    
    <div class="price-summary">
        <div class="detail-item">
            <span>
                <%= cart.type === 'domain' ? `Domain (${cart.options.period} Tahun)` : `Produk ${cart.item.name}` %>
            </span>
            <strong>Rp <%= (cart.pricing.basePrice * cart.options.period).toLocaleString('id-ID') %></strong>
        </div>
        <% if (cart.type === 'domain' && cart.options.buy_whois_protection) { %>
            <div class="detail-item">
                <span>Proteksi WHOIS</span>
                <strong>Rp <%= cart.pricing.whoisPrice.toLocaleString('id-ID') %></strong>
            </div>
        <% } %>
        <hr>
        <div class="detail-item" style="font-size: 1.2rem;">
            <strong>Total Bayar</strong>
            <strong>Rp <%= cart.pricing.finalPrice.toLocaleString('id-ID') %></strong>
        </div>
    </div>
    
    <button id="pay-button" class="btn btn-primary" style="width: 100%; margin-top: 2rem; padding: 15px; font-size: 1.1rem;">
        Bayar Sekarang
    </button>
</div>