<%- include('../partials/header', { title: 'Beli Domain Baru', currentPath: '/dashboard/buy-domain' }) %>

<style>
    #domain-search-form { display: flex; box-shadow: var(--shadow-light); border-radius: 50px; }
    #domain-input { flex-grow: 1; padding: 18px 25px; border: 2px solid transparent; font-size: 1rem; border-radius: 50px 0 0 50px; outline: none; }
    #domain-search-button { padding: 18px 35px; border-radius: 0 50px 50px 0; background: var(--secondary-accent); color: white; border: none; cursor: pointer; font-size: 1rem; font-weight: 600; }
</style>

<div class="card" style="max-width: 800px; margin: 0 auto;">
    <h2><i class="fas fa-search"></i> Cari Domain Baru</h2>
    <p>Wujudkan ide Anda dengan nama domain yang sempurna.</p>
    <form id="domain-search-form">
        <input type="text" id="domain-input" placeholder="contohdomain.id atau usahadigital" required>
        <button type="submit" id="domain-search-button">Cari</button>
    </form>
    <div id="domain-results" style="margin-top: 2rem;"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const domainForm = document.getElementById('domain-search-form');
        const domainInput = document.getElementById('domain-input');
        const domainResults = document.getElementById('domain-results');
        domainForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const keyword = domainInput.value.trim();
            if (!keyword) {
                domainResults.innerHTML = `<p style="text-align: center;">Harap masukkan nama domain.</p>`;
                return;
            }
            domainResults.innerHTML = '<div style="text-align:center;"><i class="fas fa-spinner fa-spin fa-2x"></i></div>';
            try {
                const response = await fetch('/check-domain', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ keyword: keyword }) });
                if (!response.ok) throw new Error('Network error');
                const results = await response.json();
                let resultsHTML = '<ul>';
                results.forEach(result => {
                    let statusHTML = '';
                    if (result.error) {
                        statusHTML = `<span>Gagal memeriksa</span>`;
                    } else if (result.isAvailable) {
                        const orderUrl = `/dashboard/confirm-registration?domain=${result.domain}`;
                        statusHTML = `<div><span>TERSEDIA</span> <a href="${orderUrl}" class="btn btn-primary">Pesan</a></div>`;
                    } else {
                        statusHTML = `<span>Sudah Diambil</span>`;
                    }
                    resultsHTML += `<li><span>${result.domain}</span> ${statusHTML}</li>`;
                });
                resultsHTML += '</ul>';
                domainResults.innerHTML = resultsHTML;
            } catch (error) {
                domainResults.innerHTML = `<p style="text-align: center;">Terjadi kesalahan pada koneksi.</p>`;
            }
        });
    });
</script>

<%- include('../partials/footer') %>