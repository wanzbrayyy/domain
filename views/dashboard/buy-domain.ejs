<%- include('../partials/header', { title: 'Beli Domain Baru' }) %>

<div class="card" style="max-width: 800px; margin: 0 auto;">
    <h2><i class="fas fa-search"></i> Cari Domain Baru</h2>
    <p>Wujudkan ide Anda dengan nama domain yang sempurna.</p>
    <form id="domain-search-form" style="display: flex; box-shadow: var(--nexus-shadow); border-radius: 50px; margin-top: 1rem;">
        <input type="text" id="domain-input" class="form-control" placeholder="contohdomain.id atau usahadigital" required style="border-radius: 50px 0 0 50px; border-right: none;">
        <button type="submit" id="domain-search-button" class="btn btn-secondary" style="border-radius: 0 50px 50px 0;">Cari</button>
    </form>
    <div id="domain-results" style="margin-top: 2rem;"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const domainForm = document.getElementById('domain-search-form');
        const domainInput = document.getElementById('domain-input');
        const domainResults = document.getElementById('domain-results');

        const urlParams = new URLSearchParams(window.location.search);
        const domainQuery = urlParams.get('domain');
        if (domainQuery) {
            domainInput.value = domainQuery;
            domainForm.dispatchEvent(new Event('submit'));
        }

        domainForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const keyword = domainInput.value.trim();
            if (!keyword) {
                domainResults.innerHTML = `<p style="text-align: center; color: var(--nexus-danger);">Harap masukkan nama domain.</p>`;
                return;
            }
            domainResults.innerHTML = '<div class="spinner" style="border-left-color: var(--nexus-secondary);"></div>';
            try {
                const response = await fetch('/check-domain', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ keyword: keyword }) });
                if (!response.ok) throw new Error('Network error');
                const results = await response.json();
                let resultsHTML = '<ul style="list-style: none; padding: 0;">';
                results.forEach(result => {
                    let statusHTML = '';
                    if (result.error) {
                        statusHTML = `<span style="color: var(--nexus-text-gray);">Gagal memeriksa</span>`;
                    } else if (result.isAvailable) {
                        const orderUrl = `/dashboard/confirm-registration?domain=${result.domain}`;
                        statusHTML = `<div><span style="color: var(--nexus-success); font-weight: 600; margin-right: 1rem;">TERSEDIA</span> <a href="${orderUrl}" class="btn btn-primary btn-sm">Pesan</a></div>`;
                    } else {
                        statusHTML = `<span style="color: var(--nexus-text-gray);">Sudah Diambil</span>`;
                    }
                    resultsHTML += `<li class="card" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem;"><span style="font-weight: 600; font-size: 1.1rem;">${result.domain}</span> ${statusHTML}</li>`;
                });
                resultsHTML += '</ul>';
                domainResults.innerHTML = resultsHTML;
            } catch (error) {
                domainResults.innerHTML = `<p style="text-align: center; color: var(--nexus-danger);">Terjadi kesalahan pada koneksi.</p>`;
            }
        });
    });
</script>

<%- include('../partials/footer') %>